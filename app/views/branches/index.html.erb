<% if user_signed_in? %>

<p id="notice"><%= notice %></p>

<div class = "container" id="branchestable">
  <div class="row" id="branchesheader">
    <div class="col-sm-6" id="brancheslabel">
      <h1>Branches</h1>
    </div>
    <div class="col-sm-6" id="newbranchbutton">
      <h1><%= link_to 'New Branch', new_branch_path, :class=> "btn btn-info" %></h1>
    </div>
  </div>

  <table class="table table-hover table-default table-responsive" id="branches">
    <thead>
      <tr class="row-sm-6">
        <th class="col-sm-6">Name</th>
        <th class="col-sm-6">Branch json url</th>
      </tr>
    </thead>
      <% @branches.each do |branch| %>
        <tr class="row-sm-6">
          <td class="col-sm-6"><%= branch.name %></td>
          <td class="col-sm-6"><%= branch.branch_json_url %></td>
          <!--<td class="col-sm-6"><%= link_to 'Show', branch %></td>-->
          <td class="col-sm-6"><%= link_to 'Edit', edit_branch_path(branch) %></td>
          <td class="col-sm-6"><%= link_to 'Delete', branch, method: :delete, data: { confirm: 'Are you sure?' } %></td>
        </tr>
      <% end %>
  </table>
</div>

<!--<%= link_to 'New Branch', new_branch_path %>-->


<% else %>
<div class="content carousel slide" data-ride="carousel" data-interval="20000" data-pause="false" id="dashes">
</div>

<footer><p id="loading" class="loading" style="color: #fff;">Loading</p>
</footer>
<script type="text/javascript">
  $.ajax({
          'type': 'GET',
          'url': 'branches/updates',
          'dataType': 'html',
          'success': function(response)
           {
               $("#dashes").html(response);
               $("#loading").hide();
               $("#0").addClass("active");
           },
           'error': function(errorThrown)
           {
            window.location.reload();
             console.log('Error:', errorThrown);    
           }
        });
  setInterval(function(){

      $.ajax({
          'type': 'GET',
          'url': 'branches/updates',
          'dataType': 'html',
          'success': function(response)
           {
              var cur = $(".active")[0].id;
              $("#dashes").html(response);
              $("#"+cur).addClass("active");


           },
           'error': function(errorThrown)
           {
             console.log('Error on saving appointment:', errorThrown);    
           }
        });
  }, 120000);

  $(document).ready(function () {
    $(document).ajaxStart(function () {
        $("#loading").show();
    }).ajaxStop(function () {
        $("#loading").hide();
    });
  });
</script>

<% end %>


</div>
<!--JQuery, Bootstrap JS-->
<script src="https://code.jquery.com/jquery-3.1.1.slim.min.js" integrity="sha384-A7FZj7v+d/sdmMqp/nOQwliLvUsJfDHW+k9Omg/a/EheAdgtzNs3hpfag6Ed950n"
    crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/tether/1.4.0/js/tether.min.js" integrity="sha384-DztdAPBWPRXSA/3eYEEUWrWCy7G5KFbe8fFjk5JAIxUYHKkDx6Qin1DkWx51bBrb"
    crossorigin="anonymous"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.6/js/bootstrap.min.js" integrity="sha384-vBWWzlZJ8ea9aCX4pEW3rVHjgjt7zpkNpZk+02D9phzyeVkE+jo0ieGizqPLForn"
    crossorigin="anonymous"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.2.4/jquery.min.js"></script>